# FTP Enumeration (20, 21)

## Run nmap FTP vulnerability scripts
```bash
nmap --script ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221 -p 21 $IP
```

## Test anonymous FTP login
```bash
ftp $IP -a
```

## Connect to FTP with credentials
```bash
ftp $IP
```

## Recursively download all FTP files with wget
```bash
# Use username:password OR anonymous:anonymous for anonymous
wget -r ftp://anonymous:anonymous@$IP/
```

## Connect with netcat to grab banner
```bash
nc -nv $IP 21
```

## Test FTP login with hydra
```bash
hydra -l admin -P /usr/share/wordlists/rockyou.txt ftp://$IP
```

---

# FTP Enumeration Methodology

## Initial Testing

1. Check for anonymous access first (most common misconfiguration)
2. If anonymous works, enumerate all directories and files
3. Download everything for offline analysis
4. Look for sensitive files (passwords, configs, backups, keys)

## Anonymous FTP Access

Try these username/password combinations:
- anonymous:anonymous
- anonymous:
- ftp:ftp
- guest:guest

If anonymous access works, you can often read (and sometimes write) files without authentication.

## FTP Commands

Once connected, useful commands:
- `ls` - list files
- `cd directory` - change directory
- `get filename` - download file
- `put filename` - upload file (if writable)
- `mget *` - download multiple files
- `binary` - switch to binary mode (for executables/images)
- `ascii` - switch to ASCII mode (for text files)
- `pwd` - print working directory
- `passive` - toggle passive mode

## Common FTP Misconfigurations

**Writable anonymous FTP:**
If you can write files, you might be able to:
- Upload a web shell if FTP directory is web-accessible
- Upload malicious files for other users to execute
- Replace legitimate files with backdoored versions

**Home directory access:**
Sometimes FTP exposes user home directories, which may contain:
- SSH keys (.ssh/id_rsa)
- Bash history (.bash_history)
- Configuration files with credentials
- Personal documents

## FTP Bounce Attack

Some FTP servers allow PORT command exploitation to scan internal networks or connect to other services. This is rare on modern systems but worth testing on older targets.

## Version-Specific Vulnerabilities

**ProFTPd:**
- Check for backdoored versions (CVE-2010-4221)
- SITE CPFR/CPTO commands for arbitrary file copy

**vsftpd:**
- Backdoor in version 2.3.4 (smiley face backdoor)
- nmap script ftp-vsftpd-backdoor detects this

**Pure-FTPd, FileZilla Server:**
- Check for known vulnerabilities based on version

## Brute Force Considerations

Only use brute force as a last resort:
- Very slow protocol
- Often triggers account lockouts
- Generates lots of logs
- Use small, targeted wordlists only

## File Discovery

Look for these file types:
- Configuration files: .conf, .config, .ini, .xml
- Database files: .sql, .db, .sqlite
- Backup files: .bak, .old, .backup, .zip, .tar.gz
- Key files: .pem, .key, .ppk, id_rsa
- Scripts: .sh, .ps1, .bat, .py, .pl

## Next Steps

Once FTP access is gained:
1. Download all accessible files
2. Search for credentials and sensitive information
3. Check if FTP directory is web-accessible (try accessing via HTTP)
4. Test for write access to upload malicious files
5. Look for SSH keys for lateral movement

---

# References

- https://book.hacktricks.xyz/network-services-pentesting/pentesting-ftp
- https://www.exploit-db.com/exploits/17491 (vsftpd backdoor)
